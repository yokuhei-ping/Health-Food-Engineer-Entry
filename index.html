<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ä¿å¥é£Ÿå“åˆç´šå·¥ç¨‹å¸«ï½œæ­·å±†è©¦é¡Œç·šä¸Šç·´ç¿’</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-50">
    <div id="root" class="p-6 text-gray-600">App è¼‰å…¥ä¸­â€¦</div>
    <noscript>æœ¬é éœ€è¦å•Ÿç”¨ JavaScript æ‰èƒ½ä½¿ç”¨ã€‚</noscript>

    <!-- å¿…è¦å‡½å¼åº«ï¼ˆCDNï¼‰ -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

    <script type="text/babel" data-presets="env,react">
      // å…¼å®¹æ€§ï¼šé¿å…ä½¿ç”¨ ?. å’Œ ??ï¼Œåƒ…ç”¨å‚³çµ±å¯«æ³•
      const { useState, useEffect, useMemo, useRef } = React;
      const PapaLib = window.Papa || {};
      const FileSaver = window.FileSaver || { saveAs: window.saveAs };

      // ==== å·¥å…· ====
      const LS_KEY = "hf-beginner-exam-app-v1";
      const serialize = (data) => JSON.stringify(data);
      const deserialize = (s) => { try { return s ? JSON.parse(s) : null; } catch { return null; } };
      const deBOM = (s) => (typeof s === "string" ? s.replace(/^\\uFEFF/, "") : s);
      const normalizeKeys = (raw) => {
        const out = {};
        if (!raw) return out;
        Object.keys(raw).forEach((k) => {
          const nk = deBOM(String(k)).trim();
          out[nk] = raw[k];
        });
        return out;
      };
      const pick = (obj, keys) => {
        obj = obj || {};
        for (var i = 0; i < keys.length; i++) {
          var k = keys[i];
          if (obj[k] != null && obj[k] !== "") return obj[k];
        }
        return undefined;
      };
      const shuffle = (arr) => {
        var copy = (arr || []).slice();
        for (var i = copy.length - 1; i > 0; i--) {
          var j = Math.floor(Math.random() * (i + 1));
          var t = copy[i]; copy[i] = copy[j]; copy[j] = t;
        }
        return copy;
      };
      const fmtTime = (s) => {
        s = Math.max(0, Number(s)||0);
        var mm = Math.floor(s / 60).toString().padStart(2, "0");
        var ss = Math.floor(s % 60).toString().padStart(2, "0");
        return mm + ":" + ss;
      };

      // QA è½‰æ›
      const rowToQA = (row) => {
        const r = normalizeKeys(row);
        const year = String(pick(r, ["year", "å¹´åº¦", "å¹´ä»½"]) || "").trim();
        const subject = String(pick(r, ["subject", "ç§‘ç›®"]) || "").trim();
        const question_no = String(pick(r, ["question_no", "é¡Œè™Ÿ", "é¡Œç›®ç·¨è™Ÿ", "no", "id"]) || "").trim();
        const question = String(pick(r, ["question", "é¡Œç›®", "stem"]) || "").trim();
        const option_A = String(pick(r, ["option_A", "A", "é¸é …A"]) || "");
        const option_B = String(pick(r, ["option_B", "B", "é¸é …B"]) || "");
        const option_C = String(pick(r, ["option_C", "C", "é¸é …C"]) || "");
        const option_D = String(pick(r, ["option_D", "D", "é¸é …D"]) || "");
        const correct_answers = String(pick(r, ["correct_answers", "æ­£ç¢ºç­”æ¡ˆ", "answer"]) || "").replace(/\\s/g, "");
        const notes = String(pick(r, ["notes", "å‚™è¨»"]) || "");
        const date = String(pick(r, ["date", "æ—¥æœŸ"]) || "");
        const session = String(pick(r, ["session", "å ´æ¬¡"]) || "").trim();
        const salt = (date || session || (question ? String(question).slice(0, 20).replace(/\\s+/g, "") : ""));
        const id = (year || "") + "-" + salt + "-" + (subject || "") + "-" + (question_no || "");
        const opts = ["A", "B", "C", "D"].map((k) => ({
          key: k,
          text: String({A:option_A,B:option_B,C:option_C,D:option_D}[k] || "").trim(),
        }));
        return { id, year, date, subject, question_no, question, option_A, option_B, option_C, option_D, options: opts, correct_answers, notes };
      };

      const safeSaveAs = (blob, filename) => {
        try {
          const fn = (FileSaver && (FileSaver.saveAs || FileSaver.default)) || window.saveAs;
          if (typeof fn === "function") { fn(blob, filename); return; }
        } catch (e) {}
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url; a.download = filename; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
      };

      const exportCSV = (rows, filename = "export.csv") => {
        if (!PapaLib || typeof PapaLib.unparse !== "function") { alert("Papaparse å°šæœªè¼‰å…¥ï¼Œç„¡æ³•åŒ¯å‡º CSV"); return; }
        const csv = PapaLib.unparse(rows || []);
        const blob = new Blob(["\\uFEFF" + csv], { type: "text/csv;charset=utf-8;" });
        safeSaveAs(blob, filename);
      };

      const toRawUrl = (u) => {
        try {
          if (!u) return "";
          if (/^gh:/i.test(u)) {
            const m = u.replace(/^gh:/i, "").match(/^([^\\/]+)\\/([^@]+)@([^:]+):(.+)$/);
            if (m) { var user=m[1], repo=m[2], branch=m[3], path=m[4]; return "https://raw.githubusercontent.com/"+user+"/"+repo+"/"+branch+"/"+path; }
            return u;
          }
          if (/^https?:\\/\\/github\\.com\\/.+\\/blob\\//.test(u)) {
            return u.replace(/^https?:\\/\\/github\\.com\\//, "https://raw.githubusercontent.com/").replace("/blob/", "/");
          }
          return u;
        } catch { return u; }
      };

      function App() {
        const [bank, setBank] = useState([]);
        const [subject, setSubject] = useState("å…¨éƒ¨ç§‘ç›®");
        const [year, setYear] = useState("å…¨éƒ¨å¹´åº¦");
        const [mode, setMode] = useState("practice");
        const [limit, setLimit] = useState(40);
        const [page, setPage] = useState(0);
        const [answers, setAnswers] = useState({});
        const [started, setStarted] = useState(false);
        const [seed, setSeed] = useState(0);
        const [seconds, setSeconds] = useState(0);
        const timerRef = useRef(null);
        const [bankUrl, setBankUrl] = useState("gh:yokuhei-ping/Health-Food-Engineer-Entry@b18caf88dce70271f4e51f25c0931fa0efbbed39:Question_All_corrected.csv");

        useEffect(function() {
          const saved = deserialize((function(){try{return localStorage.getItem(LS_KEY);}catch(e){return null;}})());
          if (saved) {
            setBank(saved.bank || []);
            setSubject(saved.subject || "å…¨éƒ¨ç§‘ç›®");
            setYear(saved.year || "å…¨éƒ¨å¹´åº¦");
            setMode(saved.mode || "practice");
          }
        }, []);

        useEffect(function() {
          try { localStorage.setItem(LS_KEY, serialize({ bank:bank, subject:subject, year:year, mode:mode })); } catch (e) {}
        }, [bank, subject, year, mode]);

        const subjects = useMemo(function() {
          const set = new Set((bank||[]).map(function(q){ return String((q.subject||"")).trim(); }));
          return ["å…¨éƒ¨ç§‘ç›®"].concat(Array.from(set).filter(Boolean));
        }, [bank]);

        const years = useMemo(function() {
          const set = new Set((bank||[]).map(function(q){ return String((q.year==null?"":q.year)).trim(); }));
          const arr = Array.from(set).filter(Boolean).sort(function(a,b){ return Number(b)-Number(a); });
          return ["å…¨éƒ¨å¹´åº¦"].concat(arr);
        }, [bank]);

        const filtered = useMemo(function() {
          return (bank||[]).filter(function(q){
            const okS = subject === "å…¨éƒ¨ç§‘ç›®" || String(q.subject||"").trim() === subject;
            const okY = year === "å…¨éƒ¨å¹´åº¦" || String(q.year==null?"":q.year).trim() === year;
            return okS && okY;
          });
        }, [bank, subject, year]);

        const paper = useMemo(function() {
          const base = shuffle(filtered.slice());
          const n = Math.min(limit, base.length);
          return base.slice(0, n).map(function(q, i){ return Object.assign({}, q, { order: i+1 }); });
        }, [filtered, limit, seed]);

        useEffect(function() {
          if (!started || mode !== "exam") return;
          timerRef.current = window.setInterval(function(){ setSeconds(function(s){ return s+1; }); }, 1000);
          return function(){ if (timerRef.current) window.clearInterval(timerRef.current); };
        }, [started, mode]);

        const start = function(){ setAnswers({}); setPage(0); setSeed(function(s){return s+1;}); setSeconds(0); setStarted(true); };
        const stop = function(){ setStarted(false); if (timerRef.current) window.clearInterval(timerRef.current); };

        const current = paper[page] || null;
        const choose = function(qid, key){ setAnswers(function(prev){ var next = Object.assign({}, prev); next[qid]=key; return next; }); };
        const isCorrect = function(q, user){
          const ok = String(q.correct_answers||"").split(",").map(function(x){return x.trim();}).filter(Boolean);
          return user ? ok.indexOf(user) >= 0 : false;
        };

        const score = useMemo(function(){
          var right = 0; paper.forEach(function(q){ if (isCorrect(q, answers[q.id])) right += 1; });
          return { right: right, total: paper.length };
        }, [paper, answers]);

        const wrongList = useMemo(function(){ return paper.filter(function(q){ return !isCorrect(q, answers[q.id]); }); }, [paper, answers]);

        const onImport = function(file){
          if (!file) { alert("å°šæœªé¸æ“‡é¡Œåº«æª”æ¡ˆ"); return; }
          const name = String(file.name||"").toLowerCase();
          if (name.slice(-4) === ".csv") {
            PapaLib.parse(file, {
              header: true,
              skipEmptyLines: true,
              complete: function(res){
                var ok = 0, skipped = 0;
                const rows = (res.data || []).map(function(raw){
                  const base = normalizeKeys(raw);
                  const r = Object.assign({}, base);
                  r.year = r.year || r["å¹´åº¦"] || r["å¹´ä»½"] || r["\\ufeffyear"];
                  r.subject = r.subject || r["ç§‘ç›®"];
                  r.question_no = r.question_no || r["é¡Œè™Ÿ"] || r["é¡Œç›®ç·¨è™Ÿ"] || r["no"] || r["\\ufeffquestion_no"];
                  r.question = r.question || r["é¡Œç›®"] || r["stem"];
                  r.option_A = r.option_A || r["A"] || r["é¸é …A"];
                  r.option_B = r.option_B || r["B"] || r["é¸é …B"];
                  r.option_C = r.option_C || r["C"] || r["é¸é …C"];
                  r.option_D = r.option_D || r["D"] || r["é¸é …D"];
                  r.correct_answers = r.correct_answers || r["æ­£ç¢ºç­”æ¡ˆ"] || r["answer"];
                  r.notes = r.notes || r["å‚™è¨»"];
                  r.date = r.date || r["æ—¥æœŸ"]; r.session = r.session || r["å ´æ¬¡"] || r["session"];
                  const qa = rowToQA(r);
                  if (!qa.year || !qa.subject || !qa.question_no) { skipped += 1; return null; }
                  ok += 1; return qa;
                }).filter(Boolean);
                const dup = countDup(bank, rows);
                setBank(function(prev){ return mergeBank(prev, rows); });
                alert("å·²åŒ¯å…¥ " + ok + " é¡Œ" + (skipped ? "ï¼Œç•¥é " + skipped + " é¡Œï¼ˆç¼ºå°‘ å¹´åº¦/ç§‘ç›®/é¡Œè™Ÿï¼‰" : "") + "ï¼›å…¶ä¸­ " + dup + " é¡Œèˆ‡æ—¢æœ‰é¡Œç›®ï¼ˆç›¸åŒ å¹´åº¦/æ—¥æœŸ(æˆ–å ´æ¬¡)/ç§‘ç›®/é¡Œè™Ÿï¼‰é‡è¤‡ï¼Œå·²è‡ªå‹•åˆä½µ");
              },
            });
            return;
          }
          if (name.slice(-5) === ".json") {
            const reader = new FileReader();
            reader.onload = function(){
              try{
                const json = JSON.parse(String(reader.result||""));
                const arr = Array.isArray(json) ? json : (json.items || []);
                var ok = 0, skipped = 0;
                const rows = arr.map(function(raw){
                  const base = normalizeKeys(raw);
                  const r = Object.assign({}, base);
                  r.year = r.year || r["å¹´åº¦"] || r["å¹´ä»½"];
                  r.subject = r.subject || r["ç§‘ç›®"];
                  r.question_no = r.question_no || r["é¡Œè™Ÿ"] || r["é¡Œç›®ç·¨è™Ÿ"] || r["no"];
                  r.question = r.question || r["é¡Œç›®"] || r["stem"];
                  r.option_A = r.option_A || r["A"] || r["é¸é …A"];
                  r.option_B = r.option_B || r["B"] || r["é¸é …B"];
                  r.option_C = r.option_C || r["C"] || r["é¸é …C"];
                  r.option_D = r.option_D || r["D"] || r["é¸é …D"];
                  r.correct_answers = r.correct_answers || r["æ­£ç¢ºç­”æ¡ˆ"] || r["answer"];
                  r.notes = r.notes || r["å‚™è¨»"];
                  r.date = r.date || r["æ—¥æœŸ"];
                  const qa = rowToQA(r);
                  if (!qa.year || !qa.subject || !qa.question_no) { skipped += 1; return null; }
                  ok += 1; return qa;
                }).filter(Boolean);
                const dup = countDup(bank, rows);
                setBank(function(prev){ return mergeBank(prev, rows); });
                alert("å·²åŒ¯å…¥ " + ok + " é¡Œ" + (skipped ? "ï¼Œç•¥é " + skipped + " é¡Œï¼ˆç¼ºå°‘ å¹´åº¦/ç§‘ç›®/é¡Œè™Ÿï¼‰" : "") + "ï¼›å…¶ä¸­ " + dup + " é¡Œèˆ‡æ—¢æœ‰é¡Œç›®ï¼ˆç›¸åŒ å¹´åº¦/æ—¥æœŸ(æˆ–å ´æ¬¡)/ç§‘ç›®/é¡Œè™Ÿï¼‰é‡è¤‡ï¼Œå·²è‡ªå‹•åˆä½µ");
              } catch { alert("JSON è§£æå¤±æ•—"); }
            };
            reader.readAsText(file, "utf-8");
            return;
          }
          alert("è«‹ä¸Šå‚³ CSV æˆ– JSON æª”");
        };

        const onImportUrl = function(url){
          const u = toRawUrl(String(url||"").trim());
          if (!u) { alert("è«‹è¼¸å…¥é¡Œåº«ç¶²å€"); return; }
          if (/\\.csv(?:$|\\?)/i.test(u)) {
            PapaLib.parse(u, {
              download: true,
              header: true,
              skipEmptyLines: true,
              complete: function(res){
                var ok = 0, skipped = 0;
                const rows = (res.data || []).map(function(raw){
                  const base = normalizeKeys(raw);
                  const r = Object.assign({}, base);
                  r.year = r.year || r["å¹´åº¦"] || r["å¹´ä»½"] || r["ï»¿year"];
                  r.subject = r.subject || r["ç§‘ç›®"];
                  r.question_no = r.question_no || r["é¡Œè™Ÿ"] || r["é¡Œç›®ç·¨è™Ÿ"] || r["no"] || r["ï»¿question_no"];
                  r.question = r.question || r["é¡Œç›®"] || r["stem"];
                  r.option_A = r.option_A || r["A"] || r["é¸é …A"];
                  r.option_B = r.option_B || r["B"] || r["é¸é …B"];
                  r.option_C = r.option_C || r["C"] || r["é¸é …C"];
                  r.option_D = r.option_D || r["D"] || r["é¸é …D"];
                  r.correct_answers = r.correct_answers || r["æ­£ç¢ºç­”æ¡ˆ"] || r["answer"];
                  r.notes = r.notes || r["å‚™è¨»"];
                  r.date = r.date || r["æ—¥æœŸ"];
                  r.session = r.session || r["å ´æ¬¡"] || r["session"];
                  const qa = rowToQA(r);
                  if (!qa.year || !qa.subject || !qa.question_no) { skipped += 1; return null; }
                  ok += 1; return qa;
                }).filter(Boolean);
                const dup = countDup(bank, rows);
                setBank(function(prev){ return mergeBank(prev, rows); });
                alert("å·²å¾ç¶²å€åŒ¯å…¥ " + ok + " é¡Œ" + (skipped ? "ï¼Œç•¥é " + skipped + " é¡Œï¼ˆç¼ºå°‘ å¹´åº¦/ç§‘ç›®/é¡Œè™Ÿï¼‰" : "") + "ï¼›å…¶ä¸­ " + dup + " é¡Œèˆ‡æ—¢æœ‰é¡Œç›®é‡è¤‡ï¼Œå·²è‡ªå‹•åˆä½µ");
              },
              error: function(){ alert("ä¸‹è¼‰ CSV å¤±æ•—ï¼Œè«‹ç¢ºèªç¶²å€å¯å…¬é–‹å­˜å–"); },
            });
          } else if (/\\.json(?:$|\\?)/i.test(u)) {
            fetch(u, { cache: "no-store" })
              .then(function(r){ if (!r.ok) throw new Error("HTTP " + r.status); return r.json(); })
              .then(function(json){
                const arr = Array.isArray(json) ? json : (json.items || []);
                var ok = 0, skipped = 0;
                const rows = arr.map(function(raw){
                  const base = normalizeKeys(raw);
                  const r = Object.assign({}, base);
                  r.year = r.year || r["å¹´åº¦"] || r["å¹´ä»½"];
                  r.subject = r.subject || r["ç§‘ç›®"];
                  r.question_no = r.question_no || r["é¡Œè™Ÿ"] || r["é¡Œç›®ç·¨è™Ÿ"] || r["no"];
                  r.question = r.question || r["é¡Œç›®"] || r["stem"];
                  r.option_A = r.option_A || r["A"] || r["é¸é …A"];
                  r.option_B = r.option_B || r["B"] || r["é¸é …B"];
                  r.option_C = r.option_C || r["C"] || r["é¸é …C"];
                  r.option_D = r.option_D || r["D"] || r["é¸é …D"];
                  r.correct_answers = r.correct_answers || r["æ­£ç¢ºç­”æ¡ˆ"] || r["answer"];
                  r.notes = r.notes || r["å‚™è¨»"];
                  r.date = r.date || r["æ—¥æœŸ"];
                  r.session = r.session || r["å ´æ¬¡"] || r["session"];
                  const qa = rowToQA(r);
                  if (!qa.year || !qa.subject || !qa.question_no) { skipped += 1; return null; }
                  ok += 1; return qa;
                }).filter(Boolean);
                const dup = countDup(bank, rows);
                setBank(function(prev){ return mergeBank(prev, rows); });
                alert("å·²å¾ç¶²å€åŒ¯å…¥ " + ok + " é¡Œ" + (skipped ? "ï¼Œç•¥é " + skipped + " é¡Œï¼ˆç¼ºå°‘ å¹´åº¦/ç§‘ç›®/é¡Œè™Ÿï¼‰" : "") + "ï¼›å…¶ä¸­ " + dup + " é¡Œèˆ‡æ—¢æœ‰é¡Œç›®é‡è¤‡ï¼Œå·²è‡ªå‹•åˆä½µ");
              })
              .catch(function(){ alert("ä¸‹è¼‰ JSON å¤±æ•—ï¼Œè«‹ç¢ºèªç¶²å€å¯å…¬é–‹å­˜å–"); });
          } else {
            alert("è«‹æä¾› .csv æˆ– .json é€£çµï¼ˆå»ºè­°ä½¿ç”¨ GitHub çš„ Raw é€£çµæˆ– gh: åˆ¥åï¼‰");
          }
        };

        const handleImportChange = function(e){
          const files = (e && e.target && e.target.files) ? e.target.files : null;
          const file = files && files[0] ? files[0] : null;
          if (!file) { alert("å°šæœªé¸æ“‡é¡Œåº«æª”æ¡ˆ"); return; }
          onImport(file);
          try { e.target.value = ""; } catch {}
        };

        const mergeBank = function(prev, rows){
          const map = new Map((prev||[]).map(function(q){ return [q.id, q]; }));
          (rows||[]).forEach(function(r){ map.set(r.id, r); });
          return Array.from(map.values());
        };

        const countDup = function(prev, rows){
          const set = new Set((prev||[]).map(function(q){ return q.id; }));
          var dup = 0; (rows||[]).forEach(function(r){ if (set.has(r.id)) dup += 1; });
          return dup;
        };

        const exportWrong = function(){
          if (!wrongList.length) { alert("ç›®å‰æ²’æœ‰å¯åŒ¯å‡ºçš„éŒ¯é¡Œï¼ˆè«‹å…ˆé–‹å§‹ä½œç­”ä¸¦ç”¢ç”ŸéŒ¯é¡Œï¼‰"); return; }
          const rows = wrongList.map(function(q){
            return {
              year: q.year, subject: q.subject, question_no: q.question_no, question: q.question,
              option_A: q.option_A, option_B: q.option_B, option_C: q.option_C, option_D: q.option_D,
              correct_answers: q.correct_answers, notes: q.notes,
            };
          });
          try { exportCSV(rows, "éŒ¯é¡Œæœ¬.csv"); alert("å·²åŒ¯å‡º " + rows.length + " é¡ŒéŒ¯é¡Œè‡³ã€ŒéŒ¯é¡Œæœ¬.csvã€"); }
          catch (e) { console.error(e); alert("ä¸‹è¼‰å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç€è¦½å™¨ä¸‹è¼‰æ¬Šé™"); }
        };

        const clearBank = function(){
          var ok = true;
          try { ok = window.confirm("ç¢ºå®šè¦æ¸…ç©ºç›®å‰é¡Œåº«å—ï¼Ÿï¼ˆå°‡åŒæ™‚åˆªé™¤æœ¬åœ°å¿«å–ï¼‰"); } catch(e){}
          if (!ok) return;
          setBank([]); setAnswers({}); setStarted(false); setPage(0); setSeed(function(s){return s+1;});
          try { localStorage.removeItem(LS_KEY); } catch (e) { console.warn("ç„¡æ³•å­˜å– localStorageï¼š", e); }
          alert("é¡Œåº«èˆ‡å¿«å–å·²æ¸…ç©º");
        };

        return (
          <div className="min-h-screen bg-gray-50 text-gray-800 p-6">
            <header className="max-w-5xl mx-auto mb-4">
              <h1 className="text-2xl sm:text-3xl font-bold">ä¿å¥é£Ÿå“åˆç´šå·¥ç¨‹å¸«ï½œæ­·å±†è©¦é¡Œç·šä¸Šç·´ç¿’</h1>
              <p className="text-sm text-gray-600 mt-1">åŒ¯å…¥æ­·å±† CSV/JSON é¡Œåº« â†’ ç¯©é¸ç§‘ç›®/å¹´åº¦ â†’ ç·´ç¿’/æ¨¡æ“¬è€ƒï¼ˆæ”¯æ´å¤šç­”æ¡ˆçµ¦åˆ†èˆ‡éŒ¯é¡Œæœ¬ï¼‰</p>
            </header>

            <main className="max-w-5xl mx-auto grid gap-4">
              <section className="bg-white rounded-2xl shadow p-4 grid gap-3">
                <div className="flex flex-wrap items-center gap-3">
                  <label className="text-sm">ç§‘ç›®</label>
                  <select className="border rounded-xl px-3 py-2" value={subject} onChange={function(e){ setSubject(e.target.value); }}>
                    {subjects.map(function(s){ return (<option key={s} value={s}>{s}</option>); })}
                  </select>

                  <label className="text-sm ml-2">å¹´åº¦</label>
                  <select className="border rounded-xl px-3 py-2" value={year} onChange={function(e){ setYear(e.target.value); }}>
                    {years.map(function(y){ return (<option key={y} value={y}>{y}</option>); })}
                  </select>

                  <label className="text-sm ml-2">æ¨¡å¼</label>
                  <select className="border rounded-xl px-3 py-2" value={mode} onChange={function(e){ setMode(e.target.value); }}>
                    <option value="practice">ç·´ç¿’ï¼ˆå³æ™‚å°ç­”æ¡ˆï¼‰</option>
                    <option value="exam">æ¨¡æ“¬è€ƒï¼ˆäº¤å·å¾Œæ­æ›‰ï¼‰</option>
                  </select>

                  <label className="text-sm ml-2">é¡Œæ•¸</label>
                  <input className="border rounded-xl px-3 py-2 w-24" type="number" min={1} max={200} value={limit} onChange={function(e){ setLimit(Number(e.target.value || 1)); }} />

                  <label className="text-sm ml-2">åŒ¯å…¥é¡Œåº«</label>
                  <input className="border rounded-xl px-3 py-2" type="file" accept=".csv,.json" onChange={handleImportChange} />
                  <input className="border rounded-xl px-3 py-2 w-64" type="url" placeholder="è²¼ä¸Šé¡Œåº« CSV/JSON ç¶²å€æˆ– gh:åˆ¥å" value={bankUrl} onChange={function(e){ setBankUrl(e.target.value); }} />
                  <button className="rounded-2xl px-4 py-2 border" onClick={function(){ onImportUrl(bankUrl); }}>å¾ç¶²å€è¼‰å…¥</button>

                  <button className="ml-auto rounded-2xl px-4 py-2 bg-gray-900 text-white hover:opacity-90" onClick={start}>é–‹å§‹ä½œç­”</button>
                  {started ? (<button className="rounded-2xl px-4 py-2 border" onClick={stop}>çµæŸ/äº¤å·</button>) : null}
                </div>
                <div className="flex gap-2 flex-wrap text-sm">
                  <button className="rounded-xl px-3 py-2 border" onClick={exportWrong}>åŒ¯å‡ºéŒ¯é¡Œæœ¬ CSV</button>
                  <button className="rounded-xl px-3 py-2 border" onClick={clearBank}>æ¸…ç©ºé¡Œåº«</button>
                </div>
                <div className="text-sm text-gray-600">ç›®å‰é¡Œåº«ï¼š{filtered.length} é¡Œï¼ˆç¬¦åˆç¯©é¸ï¼‰ï¼ å…¨éƒ¨ {bank.length} é¡Œ</div>
                <div className="text-xs text-gray-500">å”¯ä¸€éµï¼šå¹´-æ—¥æœŸ(æˆ–å ´æ¬¡)-ç§‘ç›®-é¡Œè™Ÿï¼ˆé¿å…ä¸åŒå ´æ¬¡åŒé¡Œè™Ÿè¢«åˆä½µï¼‰</div>
              </section>

              {started && current && (
                <section className="bg-white rounded-2xl shadow p-5">
                  <div className="flex items-start gap-3 flex-wrap">
                    <div className="text-xs px-2 py-1 rounded-full bg-gray-100">{mode === "exam" ? "æ¨¡æ“¬è€ƒ" : "ç·´ç¿’"}</div>
                    <div className="text-xs px-2 py-1 rounded-full bg-gray-100">{current.subject || "â€”"}</div>
                    <div className="text-xs px-2 py-1 rounded-full bg-gray-100">{current.year || "â€”"} å¹´</div>
                    <div className="text-xs px-2 py-1 rounded-full bg-gray-100">é¡Œè™Ÿï¼š{current.question_no}</div>
                    <div className="text-xs px-2 py-1 rounded-full bg-gray-100">ç¬¬ {page + 1} / {paper.length} é¡Œ</div>
                    {mode === "exam" ? (<div className="text-xs px-2 py-1 rounded-full bg-gray-100">è¨ˆæ™‚ï¼š{fmtTime(seconds)}</div>) : null}
                  </div>

                  <h2 className="mt-3 text-lg font-semibold leading-relaxed whitespace-pre-wrap">{current.question}</h2>

                  <ul className="mt-4 grid gap-2">
                    {current.options && current.options.map(function(op){
                      const picked = answers[current.id] === op.key;
                      const showAnswer = mode === "practice" && picked;
                      const correctSet = String(current.correct_answers || "").split(",").map(function(x){ return x.trim(); });
                      const isRight = correctSet.indexOf(op.key) >= 0;
                      const className = [
                        "w-full text-left border rounded-xl p-3 hover:bg-gray-50",
                        picked && showAnswer && (isRight ? "border-green-500 bg-green-50" : "border-red-400 bg-red-50"),
                      ].join(" ");
                      return (
                        <li key={op.key}>
                          <button className={className} onClick={function(){ choose(current.id, op.key); }}>
                            <span className="font-mono mr-2">({op.key})</span>
                            <span className="whitespace-pre-wrap">{op.text || "â€”"}</span>
                          </button>
                        </li>
                      );
                    })}
                  </ul>

                  {mode === "practice" && (
                    <div className="mt-4 text-sm">
                      {answers[current.id] ? (
                        isCorrect(current, answers[current.id]) ? (
                          <div className="text-green-700">âœ” æ­å–œç­”å°ï¼å¯æ¥å—ç­”æ¡ˆï¼š{current.correct_answers}</div>
                        ) : (
                          <div className="text-red-700">âœ˜ ç­”éŒ¯äº†ï¼Œæ­£è§£ï¼š{current.correct_answers}</div>
                        )
                      ) : (
                        <div className="text-gray-500">è«‹é¸æ“‡ä¸€å€‹é¸é …ä½œç­”</div>
                      )}
                      {current.notes ? (<div className="mt-1 text-gray-600">å‚™è¨»ï¼š{current.notes}</div>) : null}
                    </div>
                  )}

                  <div className="mt-5 flex gap-2">
                    <button className="rounded-xl px-4 py-2 border" disabled={page === 0} onClick={function(){ setPage(function(p){ return Math.max(0, p - 1); }); }}>ä¸Šä¸€é¡Œ</button>
                    <button className="rounded-xl px-4 py-2 border" disabled={page >= paper.length - 1} onClick={function(){ setPage(function(p){ return Math.min(paper.length - 1, p + 1); }); }}>ä¸‹ä¸€é¡Œ</button>
                    <button className="rounded-xl px-4 py-2 border ml-auto" onClick={function(){ setPage(0); }}>å›åˆ°ç¬¬ 1 é¡Œ</button>
                  </div>
                </section>
              )}

              {started && (
                <section className="bg-white rounded-2xl shadow p-5 grid gap-3">
                  <div className="text-sm">ä½œç­”é€²åº¦ï¼š{Object.keys(answers).length}/{paper.length} é¡Œ</div>
                  <div className="text-lg">ç›®å‰çµ±è¨ˆï¼š<span className="font-semibold">{score.right}</span> / {score.total} é¡Œ æ­£ç¢º</div>
                  <div className="flex gap-2 flex-wrap">
                    <button className="rounded-xl px-4 py-2 bg-gray-900 text-white" onClick={stop}>çµæŸ / äº¤å·</button>
                    <button className="rounded-xl px-4 py-2 border" onClick={function(){ setSeed(function(s){ return s+1; }); }}>é‡æŠ½é¡Œç›®</button>
                    <button className="rounded-xl px-4 py-2 border" onClick={exportWrong}>åŒ¯å‡ºéŒ¯é¡Œæœ¬ CSV</button>
                  </div>
                  {wrongList.length ? (<div className="text-sm text-gray-600">ç›®å‰éŒ¯é¡Œï¼š{wrongList.length} é¡Œï¼ˆå¯ç”¨ä¸Šæ–¹æŒ‰éˆ•åŒ¯å‡º CSV ç•¶éŒ¯é¡Œæœ¬ï¼‰</div>) : null}
                </section>
              )}

              {!bank.length && (
                <section className="bg-white rounded-2xl shadow p-6">
                  <h3 className="text-lg font-semibold mb-2">ğŸ‘‹ å…ˆä¸Šå‚³æˆ–è²¼ä¸Šé¡Œåº«é€£çµé–‹å§‹ä½¿ç”¨</h3>
                  <ol className="list-decimal pl-6 space-y-2 text-sm text-gray-700">
                    <li>é»ä¸Šæ–¹ <b>åŒ¯å…¥é¡Œåº«</b>ï¼Œä¸Šå‚³ CSV æˆ– JSONï¼ˆå»ºè­°ä½¿ç”¨ä½ ç”¢å‡ºçš„é¡Œåº«æª”ï¼‰ã€‚</li>
                    <li>CSV æ¬„ä½ï¼š<code>year, date, subject, question_no, question, option_A, option_B, option_C, option_D, correct_answers, notes</code></li>
                    <li>å¤šå€‹å¯æ¥å—ç­”æ¡ˆè«‹ä»¥é€—è™Ÿåˆ†éš”ï¼Œå¦‚ <code>"A,B,C"</code>ã€‚</li>
                  </ol>
                </section>
              )}
            </main>

            <footer className="max-w-5xl mx-auto py-8 text-center text-xs text-gray-400">Â© ç·´ç¿’åŸå‹ â€” å¯è‡ªè¡Œéƒ¨ç½²è‡³ Vercel / Netlify / GitHub Pages</footer>
          </div>
        );
      }

      var rootEl = document.getElementById("root");
      try {
        const root = ReactDOM.createRoot(rootEl);
        root.render(<App />);
      } catch (e) {
        console.error(e);
        rootEl.innerHTML = "<div class='p-6 text-red-600'>æ‡‰ç”¨è¼‰å…¥å¤±æ•—ï¼š"+ String(e && e.message || e) +"</div>";
      }
    </script>
  </body>
</html>
